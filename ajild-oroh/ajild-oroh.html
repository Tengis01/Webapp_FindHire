<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/ajild-oroh/ajild-oroh.css">
<script type="module" src="/public/com/ch-header.js"></script>
    <title>Ажилд Орох</title>
</head>
<body>
    <ch-header></ch-header>

<form id="jobApplicationForm">
    <h1>Ажлын маягт</h1>
    <div class="first">
        <label for="last">Овог</label>
        <input type="text" id="last" name="last" placeholder="Өөрийн овог" required>
    </div>
    <div class="first">
        <label for="name">Нэр</label>
        <input type="text" id="name" name="name" placeholder="Өөрийн нэр" required>
    </div>
    <div>
        <label for="email">Email</label>
        <input type="email" placeholder="abc@example.com" required name="email" id="email">
    </div>  
    <div class="age">
        <label for="age">Нас</label>
        <input type="text" placeholder="нас" id="age" name="age" required pattern="[0-9]{2}" maxlength="2">
    </div>
    <div>
        <label for="posotion">Мэргэжлээ сонгоно уу</label>
        <select name="posotion" id="posotion" required>
            <option value="">Сонгох</option>  
            <option value="dotood">Дотоод засал</option>
            <option value="gadna">Гадаад засал</option>
            <option value="santehnik">Сантехник</option>
            <option value="tsahilgaan">Цахилгаанчин</option>
            <option value="orom">Ханын засал</option>
            <option value="goyl">Гоёл чимэглэл</option>
        </select>
    </div>
    <div>
        <label for="experience">Ажлын туршлага:</label>
        <select id="experience" name="experience" required></select>
    </div>
    <div>
        <label for="dugaar">Холбогдох утасны дугаар</label>
        <input type="tel" name="dugaar" id="dugaar" placeholder="99003322" maxlength="8" pattern="[6-9][0-9]{7}" required>
    </div>
    <div>
        <fieldset class="radio-group">
            <legend>Ажиллах боломж</legend>
            <div class="radio-row">
                <div class="radio-item">
                    <input type="radio" value="full-time" id="avail-full" name="valiability" required>
                    <label for="avail-full">Бүтэн цагаар</label>
                </div>
                <div class="radio-item">
                    <input type="radio" value="half-time" id="avail-half" name="valiability" required>
                    <label for="avail-half">Хагас цагаар</label>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="second">
        <label for="message">Өөрийн тухай товч</label>
        <textarea name="message" id="message" placeholder="Өөрийн тухай товч"></textarea>
    </div>
    <div class="password">
        <input type="password" name="" id="password" placeholder="Password">
    </div>
    <div class="button">
        <button class="submit" type="submit">Илгээх</button>
    </div>
</form>

</body>

<script>
// Experience dropdown-ыг автоматаар үүсгэх
const select = document.getElementById('experience');
for(let i = 1; i <= 10; i++){
  const option = document.createElement('option');
  option.value = i;        
  option.text = i + " жил"; 
  select.add(option);
}

// Form submit handler
document.getElementById('jobApplicationForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Submit button-г идэвхгүй болгох (давхар илгээхээс сэргийлэх)
  const submitBtn = e.target.querySelector('.submit');
  const originalText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = 'Илгээж байна...';
  
  // Form data цуглуулах
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  try {
    const response = await fetch('/api/job-application', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if (result.success) {
      // Амжилттай илгээгдсэн
      alert('✅ Таны хүсэлт амжилттай илгээгдлээ! Бид тантай удахгүй холбогдох болно.');
      e.target.reset(); // Form-ыг цэвэрлэх
    } else {
      // Алдаа гарсан
      alert('❌ Алдаа гарлаа: ' + result.message);
    }
  } catch (error) {
    // Network буюу бусад алдаа
    console.error('Алдаа:', error);
    alert('❌ Хүсэлт илгээхэд алдаа гарлаа. Дахин оролдоно уу.');
  } finally {
    // Button-г буцааж идэвхжүүлэх
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
});

// Phone number болон Age input-д зөвхөн тоо оруулах
document.getElementById('dugaar').addEventListener('input', function(e) {
  this.value = this.value.replace(/[^0-9]/g, '');
});

document.getElementById('age').addEventListener('input', function(e) {
  this.value = this.value.replace(/[^0-9]/g, '');
  
  
  const age = parseInt(this.value);
  if (this.value.length === 2) {
    if (age < 21 || age > 60) {
      this.setCustomValidity('Нас 21-60 хооронд байх ёстой');
    } else {
      this.setCustomValidity('');
    }
  }
});
</script>
</html>